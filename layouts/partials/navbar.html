{{- $logoPath := .Site.Params.navbar.logo.path | default "images/logo.png" -}}
{{- $logoLink := .Site.Params.navbar.logo.link | default .Site.Home.RelPermalink -}}
{{- $logoWidth := .Site.Params.navbar.logo.width | default "20" -}}
{{- $logoHeight := .Site.Params.navbar.logo.height | default "20" -}}
{{- $logoDarkPath := .Site.Params.navbar.logo.dark | default $logoPath -}}
{{- $dropdownIcon := default "images/dropdown.svg" -}}

{{- $navWidth := "hx-max-w-[90rem]" -}}
{{- with .Site.Params.navbar.width -}}
{{ if eq . "normal" -}}
{{ $navWidth = "hx-max-w-screen-xl" -}}
{{ else if eq . "full" -}}
{{ $navWidth = "max-w-full" -}}
{{ end -}}
{{- end -}}

<div class="nav-container hx-sticky hx-top-0 hx-z-20 hx-w-full hx-bg-transparent print:hx-hidden">
    <div class="nav-container-blur hx-pointer-events-none hx-absolute hx-z-[-1] hx-h-full hx-w-full hx-bg-white dark:hx-bg-dark contrast-more:hx-shadow-[0_0_0_1px_#000] dark:hx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:dark:hx-shadow-[0_0_0_1px_#fff]"></div>

    <nav class="hx-mx-auto hx-flex hx-items-center hx-justify-end hx-gap-2 hx-h-16 hx-px-6 {{ $navWidth }}">
        <a class="hx-flex hx-items-center hover:hx-opacity-75 ltr:hx-mr-auto rtl:hx-ml-auto" href="{{ $logoLink }}">
            {{- if (.Site.Params.navbar.displayLogo | default true) }}
            <img class="hx-block dark:hx-hidden" src="{{ $logoPath | relURL }}" alt="{{ .Site.Title }}" height="{{ $logoHeight }}" width="{{ $logoWidth }}" />
            <img class="hx-hidden dark:hx-block" src="{{ $logoDarkPath | relURL }}" alt="{{ .Site.Title }}" height="{{ $logoHeight }}" width="{{ $logoWidth }}" />
            {{- end }}
            {{- if (.Site.Params.navbar.displayTitle | default true) }}
            <span class="hx-mx-2 hx-font-extrabold hx-inline hx-select-none" title="{{ .Site.Title }}">{{- .Site.Title -}}</span>
            {{- end }}
        </a>

        <ul id="nav-menu" class="hx-h-full max-md:hx-hidden">
            {{- $currentPage := . -}}
            {{ range .Site.Menus.main }}
            {{- if eq .Params.type "search" -}}
            {{- partial "search.html" (dict "params" .Params) -}}
            {{- else -}}
            {{- $link := .URL -}}
            {{- $external := strings.HasPrefix $link "http" -}}
            {{- with .PageRef -}}
            {{- if hasPrefix . "/" -}}
            {{- $link = relLangURL (strings.TrimPrefix "/" .) -}}
            {{- end -}}
            {{- end -}}

            {{/* Display icon menu item */}}
            {{- $active := or ($currentPage.HasMenuCurrent "main" .) ($currentPage.IsMenuCurrent "main" .) -}}
            {{- $activeClass := cond $active "hx-font-medium" "hx-text-red-400 hover:hx-text-red-400 dark:hx-text-gray-400 dark:hover:hx-text-gray-200" -}}

            {{ if .HasChildren }}
            <li title="{{ or (T .Identifier) .Name | safeHTML }}"
               href="{{ $link }}"
               {{ if $external }} target="_blank" rel="noreferer" {{ end }}
               class="hx-align-middle hx-cursor-pointer hx-relative hx-inline-block hx-h-full align-middle hover:hx-bg-gray-800/5">
                <a class="hx-p-4 hx-flex hx-h-full hx-items-center">
                    <p class="hx-text-sm hx-p-1 hx-text-center">{{ or (T .Identifier) .Name | safeHTML }}</p>
                    <svg fill="#FFAAAA" class="hx-inline-block fill-red-400" width="10" height="10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                         y="0px" viewBox="0 0 100 100" xml:space="preserve">
                    <polygon points="96.2,34.9 50,81.1 3.8,34.9 " />
                    </svg>
                </a>

                <ul class="custom-mt--1px hx-bg-white hx-py-2 hx-w-full hx-text-center nav-dropdown hx-absolute">
                    {{ range .Children }}
                    <li class="hx-p-2 hx-py-3">
                        <a class="hx-text-sm nav-dropdown-link"
                           {{ if findRE `^http` .URL }}
                           target="_blank" rel="noopener"
                           {{ end }}
                           href="{{- if findRE `^#` .URL -}}
                                {{- if not $.IsHome -}}
                                {{- site.Home.RelPermalink -}}
                                {{- end }}
                                {{- .URL -}}
                                {{- else -}}
                                {{- .URL | relLangURL -}}
                                {{- end -}}">
                            {{ .Name }}
                        </a>
                    </li>
                    {{ end }}
                </ul>
            </li>
            {{ else }}
                <li title="{{ or (T .Identifier) .Name | safeHTML }}"
                    href="{{ $link }}"
                    {{ if $external }} target="_blank" rel="noreferer" {{ end }}
                    class="hx-cursor-pointer hx-inline-block hx-h-full hx-align-middle hover:hx-bg-gray-800/5">
                    <a class="hx-p-4 hx-flex hx-h-full hx-items-center">
                        <p class="hx-text-sm hx-p-1 hx-text-center">{{ or (T .Identifier) .Name | safeHTML }}</p>
                        <svg fill="#FFAAAA" class="hx-fill-red-400 hx-inline-block" width="10" height="10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                             y="0px" viewBox="0 0 100 100" xml:space="preserve">
                        <polygon points="96.2,34.9 50,81.1 3.8,34.9 " />
                            </svg>
                    </a>
                </li>
            {{ end }}

            {{- end -}}
            {{ end }}

            <li class="hx-align-middle hx-cursor-pointer hx-relative hx-inline-block hx-h-full">
                <select name="language" id=""
                class="hx-p-4 hx-flex hx-h-full hx-items-center hx-text-sm hx-mx-2 hx-bg-none">
                    <option value="korean">한국어</option>
                    <option value="english">English</option>
                </select>
            </li>
            
            <li class="hx-align-middle hx-cursor-pointer hx-relative hx-inline-block">
                <img width="30" class="hx-inline-block custom-mb-1" src="images/searchicon.png">
            </li> 
            
            <li class="hx-align-middle hx-cursor-pointer hx-relative hx-inline-block hx-h-full">
                <div class="hx-p-4 hx-flex hx-h-full hx-items-center">
                    <button class="hx-text-sm hx-border hx-rounded hx-px-4 hx-py-2">
                        새신자등록
                    </button>
                </div>
            </li>  
        </ul>

        <!-- 모바일 메뉴 -->
        <button type="button" aria-label="Menu" class="hamburger-menu -hx-mr-2 hx-rounded hx-p-2 active:hx-bg-gray-400/20 md:hx-hidden">
            {{- partial "utils/icon.html" (dict "name" "hamburger-menu" "attributes" "height=24") -}}
        </button>
    </nav>
</div>
